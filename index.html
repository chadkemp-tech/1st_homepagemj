<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="TOEIC í•™ìŠµìš© ë©œë¡œë”” ê°€ì´ë“œ - ì–µì–‘ê³¼ ê°•ì„¸ë¥¼ ë…¸ë˜ì²˜ëŸ¼ ìµíˆê¸°"
    />
    <title>TOEIC ë©œë¡œë”” í•™ìŠµ</title>
    <style>
      :root {
        color-scheme: light;
        font-family: system-ui, -apple-system, 'Pretendard', 'Segoe UI', Arial, sans-serif;
        background: #F5F5F5;
        color: #333333;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 32px 16px 64px;
        background: #F5F5F5;
      }

      .page {
        width: min(960px, 100%);
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: #FFFFFF;
        border-radius: 12px;
        padding: 28px 32px;
        border: 1px solid #E0E0E0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }

      header h1 {
        margin: 0;
        font-size: clamp(1.8rem, 2vw + 1rem, 2.4rem);
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 12px;
        color: #34495e;
        font-weight: 600;
      }

      header p {
        margin: 0;
        color: #666666;
        line-height: 1.7;
        font-size: 1rem;
      }

      .card {
        background: #FFFFFF;
        border-radius: 12px;
        padding: 32px;
        border: 1px solid #E0E0E0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .card h2 {
        margin: 0 0 20px;
        font-size: 1.5rem;
        letter-spacing: -0.01em;
        color: #34495e;
        font-weight: 600;
      }

      .letter {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 28px;
        border-radius: 10px;
        background: #FAFAFA;
        border: 1px solid #E8E8E8;
        line-height: 1.8;
      }

      .letter p {
        margin: 0;
        font-size: 1.05rem;
        color: #333333;
      }

      .blank-pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 2rem;
        padding: 0.2rem 0.65rem;
        margin: 0 0.35rem;
        border-radius: 6px;
        background: #E8F4F8;
        color: #004080;
        font-weight: 600;
        letter-spacing: 0.02em;
        border: 1px solid #B3D9E6;
      }

      .answers {
        display: grid;
        gap: 18px;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .answer {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 24px;
        background: #FFFFFF;
        border-radius: 10px;
        border: 1px solid #E0E0E0;
        transition: box-shadow 0.2s ease, border-color 0.2s ease;
      }

      .answer:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: #D0D0D0;
      }

      .answer-header {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.15rem;
        font-weight: 600;
      }

      .answer-word {
        color: #34495e;
        letter-spacing: -0.01em;
      }

      .answer p {
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.7;
        color: #333333;
      }

      .answer .explanation {
        color: #666666;
      }

      .quiz-question {
        font-size: 1rem;
        font-weight: 600;
        color: #34495e;
        margin: 12px 0 16px 0;
        line-height: 1.6;
      }

      .answer .melody {
        color: #6B46C1;
        font-weight: 600;
      }

      .quiz-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 16px 0;
      }

      .quiz-option {
        padding: 12px 16px;
        background: #FAFAFA;
        border: 2px solid #E0E0E0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.95rem;
        color: #333333;
      }

      .quiz-option:hover {
        background: #F5F5F5;
        border-color: #B0B0B0;
      }

      .quiz-option.selected {
        background: #E8F4F8;
        border-color: #004080;
        color: #004080;
        font-weight: 500;
      }

      .quiz-option.correct {
        background: #E8F5E9;
        border-color: #4CAF50;
        color: #2E7D32;
        font-weight: 600;
      }

      .quiz-option.incorrect {
        background: #FFEBEE;
        border-color: #E53935;
        color: #C62828;
      }

      .show-answer-btn {
        padding: 10px 20px;
        background: #34495e;
        color: #FFFFFF;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background 0.2s ease;
        margin-top: 8px;
      }

      .show-answer-btn:hover {
        background: #2C3E50;
      }

      .answer-reveal {
        display: none;
        margin-top: 16px;
        padding: 16px;
        background: #FAFAFA;
        border-radius: 8px;
        border-left: 4px solid #6B46C1;
      }

      .answer-reveal.show {
        display: block;
      }

      .answer-reveal .correct-answer {
        font-weight: 600;
        color: #34495e;
        margin-bottom: 8px;
        font-size: 1rem;
      }

      .vocabulary-section {
        margin-top: 32px;
      }

      .vocabulary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }

      .vocab-card {
        background: #FFFFFF;
        border: 1px solid #E0E0E0;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .vocab-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: #6B46C1;
        transform: translateY(-2px);
      }

      .vocab-card.flipped {
        background: #F8F9FA;
      }

      .vocab-word {
        font-size: 1.3rem;
        font-weight: 700;
        color: #34495e;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .vocab-pronunciation {
        font-size: 0.85rem;
        color: #666666;
        font-style: italic;
        margin-bottom: 12px;
      }

      .vocab-meaning {
        font-size: 1rem;
        color: #333333;
        line-height: 1.6;
        margin-bottom: 12px;
        display: none;
      }

      .vocab-card.flipped .vocab-meaning {
        display: block;
      }

      .vocab-card.flipped .vocab-word {
        color: #6B46C1;
      }

      .vocab-example {
        font-size: 0.9rem;
        color: #666666;
        font-style: italic;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #E0E0E0;
        display: none;
      }

      .vocab-card.flipped .vocab-example {
        display: block;
      }

      .vocab-flip-hint {
        font-size: 0.8rem;
        color: #999999;
        margin-top: 8px;
        text-align: center;
      }

      .vocab-card.flipped .vocab-flip-hint {
        display: none;
      }

      .vocab-part {
        display: inline-block;
        font-size: 0.75rem;
        padding: 2px 8px;
        background: #E8F4F8;
        color: #004080;
        border-radius: 4px;
        font-weight: 500;
        margin-left: 8px;
      }

      .notes {
        background: #FAFAFA;
        padding: 24px;
        border-radius: 10px;
        border: 1px solid #E8E8E8;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .notes h3 {
        margin: 0;
        font-size: 1.2rem;
        color: #34495e;
        font-weight: 600;
      }

      .notes p {
        margin: 0;
        color: #666666;
        line-height: 1.7;
      }

      .melody-text {
        font-size: 1.05rem;
        line-height: 1.9;
        color: #333333;
        background: #FFFFFF;
        border-radius: 10px;
        border: 1px solid #E0E0E0;
        padding: 28px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .translation-text {
        display: none;
        margin: 0 0 16px 0;
        font-size: 0.9rem;
        color: #666666;
        font-style: italic;
        padding-left: 16px;
        border-left: 3px solid #6B46C1;
        line-height: 1.6;
      }

      .translation-text.show {
        display: block;
      }

      .word-token {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        margin-right: 0.5rem;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        transition: all 0.2s ease;
        position: relative;
        vertical-align: baseline;
        margin-bottom: 24px; /* pitch ì‹œê°í™” ê³µê°„ í™•ë³´ */
      }

      .word-token.active {
        background: #6B46C1;
        color: #FFFFFF;
        font-weight: 600;
      }

      .pitch-visualization {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 0px;
        background: linear-gradient(to top, #6B46C1, #9B59B6);
        border-radius: 2px;
        transition: height 0.3s ease, opacity 0.3s ease;
        opacity: 1;
        pointer-events: none;
        box-shadow: 0 2px 4px rgba(107, 70, 193, 0.3);
        z-index: 1;
      }

      .pitch-dot {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        background: #6B46C1;
        border-radius: 50%;
        opacity: 1;
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(107, 70, 193, 0.4);
        pointer-events: none;
        z-index: 2;
      }

      .word-token.active .pitch-dot {
        background: #FFFFFF;
        box-shadow: 0 2px 6px rgba(107, 70, 193, 0.6);
        transform: translateX(-50%) scale(1.2);
      }

      .pitch-bar-container {
        position: absolute;
        top: -22px;
        left: 50%;
        transform: translateX(-50%);
        width: 24px;
        height: 16px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 1;
      }

      .word-token.active .pitch-bar-container {
        opacity: 1.2;
      }

      .pitch-bar {
        width: 2.5px;
        background: linear-gradient(to top, #6B46C1, #9B59B6, #E91E63);
        border-radius: 2px 2px 0 0;
        margin: 0 0.5px;
        transition: height 0.3s ease, transform 0.2s ease;
        box-shadow: 0 1px 2px rgba(107, 70, 193, 0.3);
      }

      .word-token.active .pitch-bar {
        transform: scaleY(1.15);
        box-shadow: 0 2px 4px rgba(107, 70, 193, 0.5);
      }

      .word-token[data-stress="primary"],
      .word-token[data-stress="secondary"] {
        background: #FFEB3B;
        color: #333333;
        font-weight: 600;
        padding: 0.15rem 0.35rem;
        border-radius: 3px;
        box-shadow: 0 1px 2px rgba(255, 235, 59, 0.3);
      }

      .word-token[data-stress="primary"] {
        background: #FFEB3B;
        font-weight: 700;
      }

      .word-token[data-stress="secondary"] {
        background: #FFF9C4;
        font-weight: 600;
      }

      .word-token[data-stress="primary"].active,
      .word-token[data-stress="secondary"].active {
        background: #6B46C1;
        color: #FFFFFF;
        box-shadow: 0 2px 4px rgba(107, 70, 193, 0.4);
      }

      .interactive-card {
        background: #FFFFFF;
        border-radius: 12px;
        padding: 32px;
        border: 1px solid #E0E0E0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .control-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .control-button {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        border: 1px solid #D0D0D0;
        background: #FFFFFF;
        color: #333333;
        font-weight: 500;
        letter-spacing: -0.01em;
        cursor: pointer;
        transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        font-size: 0.95rem;
      }

      .control-button:hover:not(:disabled) {
        background: #F5F5F5;
        border-color: #B0B0B0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }

      .control-button.primary {
        background: #34495e;
        border: 1px solid #34495e;
        color: #FFFFFF;
        box-shadow: 0 2px 4px rgba(52, 73, 94, 0.2);
      }

      .control-button.primary:hover:not(:disabled) {
        background: #2C3E50;
        border-color: #2C3E50;
        box-shadow: 0 4px 8px rgba(52, 73, 94, 0.3);
      }

      .control-button.danger {
        background: #FFFFFF;
        border: 1px solid #E53935;
        color: #E53935;
        box-shadow: 0 2px 4px rgba(229, 57, 53, 0.1);
      }

      .control-button.danger:hover:not(:disabled) {
        background: #FFEBEE;
        border-color: #C62828;
        color: #C62828;
      }

      .control-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: #F5F5F5;
        color: #999999;
      }

      .audio-progress-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .audio-progress-bar {
        position: relative;
        width: 100%;
        height: 8px;
        background: #E0E0E0;
        border-radius: 4px;
        cursor: pointer;
        overflow: hidden;
      }

      .audio-progress-fill {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: #6B46C1;
        border-radius: 4px;
        transition: width 0.1s linear;
        width: 0%;
      }

      .audio-progress-handle {
        position: absolute;
        top: 50%;
        left: 0%;
        transform: translate(-50%, -50%);
        width: 16px;
        height: 16px;
        background: #6B46C1;
        border-radius: 50%;
        border: 2px solid #FFFFFF;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .audio-progress-bar:hover .audio-progress-handle {
        opacity: 1;
      }

      .audio-time-display {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.85rem;
        color: #666666;
        font-weight: 500;
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 12px;
        background: #FAFAFA;
        border-radius: 10px;
        padding: 16px 20px;
        border: 1px solid #E0E0E0;
      }

      .speed-control label {
        font-size: 0.95rem;
        font-weight: 500;
        color: #333333;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .speed-control input[type='range'] {
        flex: 1;
        max-width: 320px;
        appearance: none;
        height: 6px;
        border-radius: 999px;
        background: #E0E0E0;
        outline: none;
      }

      .speed-control input[type='range']::-webkit-slider-thumb {
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #34495e;
        box-shadow: 0 2px 4px rgba(52, 73, 94, 0.3);
        cursor: pointer;
      }

      .speed-control input[type='range']::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #34495e;
        border: none;
        box-shadow: 0 2px 4px rgba(52, 73, 94, 0.3);
        cursor: pointer;
      }

      .status {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        font-size: 0.9rem;
        color: #666666;
      }

      .status span {
        display: inline-flex;
        gap: 6px;
        align-items: center;
        background: #F5F5F5;
        border-radius: 6px;
        padding: 0.4rem 0.9rem;
        border: 1px solid #E0E0E0;
      }

      .recordings {
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: #FAFAFA;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #E0E0E0;
      }

      .recordings h3 {
        margin: 0;
        font-size: 1.05rem;
        color: #34495e;
        font-weight: 600;
      }

      .recordings-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .recordings-list audio {
        width: 100%;
        outline: none;
      }

      footer {
        font-size: 0.9rem;
        color: #999999;
        text-align: center;
      }

      .interactive-card h3 {
        color: #34495e;
        font-weight: 600;
        margin: 0 0 8px;
        font-size: 1.1rem;
      }

      .interactive-card p {
        color: #666666;
        margin: 0 0 12px;
        line-height: 1.6;
      }

      @media (max-width: 640px) {
        body {
          padding: 24px 12px 48px;
        }

        .card {
          padding: 22px;
        }

        .answers {
          grid-template-columns: 1fr;
        }

        .control-group {
          flex-direction: column;
        }

        .control-button {
          width: 100%;
        }

        .speed-control {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .speed-control input[type='range'] {
          width: 100%;
          max-width: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <h1>TOEIC ë©œë¡œë”” í•™ìŠµ ê°€ì´ë“œ</h1>
        <p>
          ì•„ë˜ íŒŒíŠ¸ 6 í¸ì§€ë¥¼ ë…¸ë˜í•˜ë“¯ ì½ì–´ ë³´ì„¸ìš”. ê´„í˜¸ë¡œ í‘œì‹œëœ ê³µë°± ë²ˆí˜¸ëŠ” ë¬¸ì œ ë²ˆí˜¸ë¥¼
          ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì •ë‹µê³¼ ì–µì–‘ íŒíŠ¸ë¥¼ ì°¸ê³ í•´ ë¦¬ë“¬ê³¼ ê°•ì„¸ë¥¼ ìµíˆê³ , í•˜ë‹¨ì˜ ë©œë¡œë”” ìŠ¤í¬ë¦½íŠ¸ë¥¼
          ë”°ë¼ ë…¸ë˜í•˜ë©° ì—°ìŠµí•´ ë³´ì„¸ìš”.
        </p>
      </header>

      <section class="card">
        <h2>í¸ì§€ ì›ë¬¸ (ê³µë°± í¬í•¨)</h2>
        <div class="letter">
          <p>June 22</p>
          <p>Ben Werth</p>
          <p>Werth Construction Company</p>
          <p>555 Alaska Avenue</p>
          <p>Chalmers, NB M1B 4N3</p>
          <p></p>
          <p>Dear Mr. Werth,</p>
          <p></p>
          <p>
            Thank you for sending the final <span class="blank-pill">4</span> for your recent order,
            which consisted of 40 cubic feet of lumber delivered on June 15. As you requested, we have
            enclosed the receipt showing the bill has been paid in full. However, we do wish to remind
            you that you still have one <span class="blank-pill">5</span> outstanding bill for
            flooring.
          </p>
          <p></p>
          <p>
            As for delivery of the flooring, we have checked with the warehouse and they said the
            materials can be sent to you by July 5.
            <span class="blank-pill">6</span>
            that day is acceptable to you, we will go ahead and process it. Please bear in mind that we
            will need confirmation from you by June 29 in order to make the July 5 date.
            <span class="blank-pill">7</span>. We hope to hear from you soon.
          </p>
          <p></p>
          <p>Sincerely,</p>
          <p></p>
          <p>John May</p>
        </div>
      </section>

      <section class="card">
        <h2>ì •ë‹µ &amp; ë©œë¡œë”” íŒíŠ¸</h2>
        <div class="answers">
          <article class="answer" data-quiz="4">
            <div class="answer-header">
              <span class="blank-pill">4</span>
              <span class="answer-word">ë¬¸ì œ 4</span>
            </div>
            <p class="quiz-question">
              ë‹¤ìŒ ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ê°€ì¥ ì ì ˆí•œ ë‹¨ì–´ëŠ”?
            </p>
            <p class="explanation">
              Thank you for sending the final <strong>_____</strong> for your recent order, which consisted of 40 cubic feet of lumber delivered on June 15.
            </p>
            <div class="quiz-options">
              <div class="quiz-option" data-value="payment">(A) payment</div>
              <div class="quiz-option" data-value="paying">(B) paying</div>
              <div class="quiz-option" data-value="paid">(C) paid</div>
              <div class="quiz-option" data-value="pay">(D) pay</div>
            </div>
            <button class="show-answer-btn" data-quiz="4">ì •ë‹µ í™•ì¸</button>
            <div class="answer-reveal" id="answer-4">
              <div class="correct-answer">ì •ë‹µ: (A) payment</div>
              <p class="explanation">
                ì†¡ì¥ ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŒì„ í™•ì¸í•˜ëŠ” ë¬¸ë§¥ì´ë¯€ë¡œ 'payment'ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°ë©ë‹ˆë‹¤.
              </p>
              <p class="melody">
                "PAY-ment"ì˜ "PAY"ì— ê°•ì„¸ë¥¼ ì£¼ê³  ë‘ ë°•ìë¡œ ëŠ˜ë ¤ ë…¸ë˜í•˜ë©´ ì™„ê²°ê°ì„ ì¤„ ìˆ˜ ìˆì–´ìš”.
              </p>
            </div>
          </article>

          <article class="answer" data-quiz="5">
            <div class="answer-header">
              <span class="blank-pill">5</span>
              <span class="answer-word">ë¬¸ì œ 5</span>
            </div>
            <p class="quiz-question">
              ë‹¤ìŒ ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ê°€ì¥ ì ì ˆí•œ ë‹¨ì–´ëŠ”?
            </p>
            <p class="explanation">
              However, we do wish to remind you that you still have one <strong>_____</strong> outstanding bill for flooring.
            </p>
            <div class="quiz-options">
              <div class="quiz-option" data-value="remaining">(A) remaining</div>
              <div class="quiz-option" data-value="remain">(B) remain</div>
              <div class="quiz-option" data-value="remained">(C) remained</div>
              <div class="quiz-option" data-value="remains">(D) remains</div>
            </div>
            <button class="show-answer-btn" data-quiz="5">ì •ë‹µ í™•ì¸</button>
            <div class="answer-reveal" id="answer-5">
              <div class="correct-answer">ì •ë‹µ: (A) remaining</div>
              <p class="explanation">
                ì•„ì§ í•œ ê±´ì˜ ë¯¸ê²°ì œ ì²­êµ¬ì„œê°€ ë‚¨ì•„ ìˆë‹¤ëŠ” ì˜ë¯¸ë¥¼ ê°•ì¡°í•˜ë¯€ë¡œ 'remaining'ì´ ì ì ˆí•©ë‹ˆë‹¤.
              </p>
              <p class="melody">
                "re-MAIN-ing"ì˜ "MAIN"ì„ ì‚´ì§ ì˜¬ë ¤ ì½ìœ¼ë©´ ê°•ì„¸ê°€ ì‚´ì•„ë‚˜ê³  ì „ì²´ëŠ” ë‚´ë ¤ì˜¤ëŠ” íë¦„ìœ¼ë¡œ
                ë¶€ë¥¼ ìˆ˜ ìˆì–´ìš”.
              </p>
            </div>
          </article>

          <article class="answer" data-quiz="6">
            <div class="answer-header">
              <span class="blank-pill">6</span>
              <span class="answer-word">ë¬¸ì œ 6</span>
            </div>
            <p class="quiz-question">
              ë‹¤ìŒ ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ê°€ì¥ ì ì ˆí•œ ë‹¨ì–´ëŠ”?
            </p>
            <p class="explanation">
              As for delivery of the flooring, we have checked with the warehouse and they said the materials can be sent to you by July 5. <strong>_____</strong> that day is acceptable to you, we will go ahead and process it.
            </p>
            <div class="quiz-options">
              <div class="quiz-option" data-value="If">(A) If</div>
              <div class="quiz-option" data-value="When">(B) When</div>
              <div class="quiz-option" data-value="Because">(C) Because</div>
              <div class="quiz-option" data-value="Although">(D) Although</div>
            </div>
            <button class="show-answer-btn" data-quiz="6">ì •ë‹µ í™•ì¸</button>
            <div class="answer-reveal" id="answer-6">
              <div class="correct-answer">ì •ë‹µ: (A) If</div>
              <p class="explanation">
                ì¡°ê±´ì„ ë‚˜íƒ€ë‚´ëŠ” ì ˆì„ ì´ëŒì–´ì•¼ í•˜ë¯€ë¡œ "If that day is acceptable â€¦" ë¬¸ì¥ì´ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.
              </p>
              <p class="melody">
                "If"ëŠ” ì§§ê²Œ ì¤€ë¹„ ë°•ìì²˜ëŸ¼ ë¶€ë¥´ê³  "that day"ëŠ” ê¸¸ê²Œ ì´ì–´ì„œ ì¡°ê±´ì„ ëª…í™•íˆ í‘œí˜„í•´ ë³´ì„¸ìš”.
              </p>
            </div>
          </article>

          <article class="answer" data-quiz="7">
            <div class="answer-header">
              <span class="blank-pill">7</span>
              <span class="answer-word">ë¬¸ì œ 7</span>
            </div>
            <p class="quiz-question">
              ë‹¤ìŒ ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ê°€ì¥ ì ì ˆí•œ ë¬¸ì¥ì€?
            </p>
            <p class="explanation">
              Please bear in mind that we will need confirmation from you by June 29 in order to make the July 5 date. <strong>_____</strong> We hope to hear from you soon.
            </p>
            <div class="quiz-options">
              <div class="quiz-option" data-value="Otherwise, we cannot guarantee the July 5 delivery date">(A) Otherwise, we cannot guarantee the July 5 delivery date</div>
              <div class="quiz-option" data-value="However, we can guarantee the July 5 delivery date">(B) However, we can guarantee the July 5 delivery date</div>
              <div class="quiz-option" data-value="Therefore, we will guarantee the July 5 delivery date">(C) Therefore, we will guarantee the July 5 delivery date</div>
              <div class="quiz-option" data-value="Moreover, we cannot guarantee the July 5 delivery date">(D) Moreover, we cannot guarantee the July 5 delivery date</div>
            </div>
            <button class="show-answer-btn" data-quiz="7">ì •ë‹µ í™•ì¸</button>
            <div class="answer-reveal" id="answer-7">
              <div class="correct-answer">ì •ë‹µ: (A) Otherwise, we cannot guarantee the July 5 delivery date</div>
              <p class="explanation">
                6ì›” 29ì¼ê¹Œì§€ íšŒì‹ í•˜ì§€ ì•Šìœ¼ë©´ 7ì›” 5ì¼ ë°°ì†¡ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•˜ëŠ” ë¬¸ì¥ì…ë‹ˆë‹¤.
              </p>
              <p class="melody">
                "Otherwise"ëŠ” ë‚®ê²Œ ì‹œì‘í•˜ê³  "cannot guarantee"ì—ì„œ ì ì  ìŒì„ ì˜¬ë ¤ ê¸´ë°•ê°ì„ í‘œí˜„í•´ ì£¼ì„¸ìš”.
              </p>
            </div>
          </article>
        </div>
      </section>

      <section class="card vocabulary-section">
        <h2>ğŸ“š ë‹¨ì–´ í•™ìŠµ</h2>
        <p style="color: #666666; margin-bottom: 20px;">
          í¸ì§€ì— ë‚˜ì˜¨ ì£¼ìš” ë‹¨ì–´ë“¤ì„ í•™ìŠµí•´ë³´ì„¸ìš”. ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ í•œê¸€ ëœ»ê³¼ ì˜ˆë¬¸ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="vocabulary-grid" id="vocabulary-grid">
          <!-- ë‹¨ì–´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </section>

      <section class="card">
        <h2>ë…¸ë˜í•˜ë“¯ ì½ê¸° ìŠ¤í¬ë¦½íŠ¸</h2>
        <div class="notes">
          <h3>ë¦¬ë“¬ ì—°ìŠµ íŒ</h3>
          <p>
            ìˆ«ìì™€ ë‚ ì§œëŠ” ë˜ë ·í•˜ê²Œ, ê°•ì„¸ê°€ ìˆëŠ” ìŒì ˆì€ í•œ ê±¸ìŒ ë” ë†’ê²Œ ì˜¬ë ¤ ë¶€ë¥´ë©´ ìì—°ìŠ¤ëŸ¬ìš´ ì–µì–‘ì´
            ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ë¬¸ë‹¨ ì‚¬ì´ì— ì§§ì€ ìˆ¨ì„ ë„£ì–´ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ í¸ì§€ì˜ íë¦„ì„ ì‚´ë ¤ ë³´ì„¸ìš”.
          </p>
        </div>
        <div style="margin-bottom: 16px;">
          <button class="control-button" id="toggle-translation" style="font-size: 0.9rem; padding: 0.6rem 1.2rem;">
            ğŸ“– ì›ë¬¸ í•´ì„ ë³´ê¸°
          </button>
        </div>
        <div class="melody-text" id="melody-text"></div>
      </section>

      <section class="interactive-card">
        <h2>ë©œë¡œë”” &amp; ìŒì„± ì—°ìŠµ ë„êµ¬</h2>
        <div class="status" id="status-bar">
          <span id="melody-status">ğŸ¼ ë©œë¡œë””: ëŒ€ê¸° ì¤‘</span>
          <span id="speech-status">ğŸ—£ï¸ ìŒì„±: ëŒ€ê¸° ì¤‘</span>
          <span id="record-status">ğŸ¤ ë…¹ìŒ: ì¤€ë¹„ ì™„ë£Œ</span>
        </div>

        <div class="speed-control">
          <label for="speed-range">
            ì¬ìƒ ì†ë„
            <span id="speed-value">1.0x</span>
          </label>
          <input type="range" id="speed-range" min="0.5" max="2.0" step="0.1" value="1.0" />
        </div>

        <div>
          <h3>1. ë©œë¡œë”” ìƒì„±</h3>
          <p>ìë™ìœ¼ë¡œ ìƒì„±ëœ ê°„ë‹¨í•œ ë©œë¡œë””ë¥¼ ë“¤ìœ¼ë©° ë‹¨ì–´ ê°•ì„¸ì™€ ë¦¬ë“¬ì„ ìµí˜€ë³´ì„¸ìš”.</p>
          <div class="control-group">
            <button class="control-button primary" id="melody-toggle">ğŸµ ë©œë¡œë”” ì¬ìƒ</button>
            <button class="control-button" id="melody-stop" disabled>â¹ ë©œë¡œë”” ì •ì§€</button>
          </div>
          <div class="audio-progress-container" id="melody-progress-container" style="display: none; margin-top: 16px;">
            <div class="audio-progress-bar" id="melody-progress-bar">
              <div class="audio-progress-fill" id="melody-progress-fill"></div>
              <div class="audio-progress-handle" id="melody-progress-handle"></div>
            </div>
            <div class="audio-time-display">
              <span id="melody-current-time">0:00</span>
              <span>/</span>
              <span id="melody-duration">0:00</span>
            </div>
          </div>
        </div>

        <div>
          <h3>2. ìŒì„± ì•ˆë‚´ ë“£ê¸°</h3>
          <p>ì›ë¬¸ì„ ìì—°ìŠ¤ëŸ¬ìš´ ì–µì–‘ìœ¼ë¡œ ì½ì–´ì£¼ëŠ” ìŒì„±ì„ ë“£ê³  ë”°ë¼ ì½ì–´ë³´ì„¸ìš”.</p>
          <div class="control-group">
            <button class="control-button primary" id="speech-toggle">â–¶ ìŒì„± ì¬ìƒ</button>
            <button class="control-button" id="speech-stop" disabled>â¹ ìŒì„± ì •ì§€</button>
          </div>
        </div>

        <div>
          <h3>3. ë‚˜ì˜ ëª©ì†Œë¦¬ ë…¹ìŒí•˜ê¸°</h3>
          <p>ë©œë¡œë””ë¥¼ ë”°ë¼ ë¶€ë¥´ë©° ìì‹ ì˜ ë°œìŒì„ ë…¹ìŒí•´ ë¹„êµí•´ ë³´ì„¸ìš”.</p>
          <div class="control-group">
            <button class="control-button primary" id="record-toggle">ğŸ¤ ë…¹ìŒ ì‹œì‘</button>
            <button class="control-button danger" id="record-stop" disabled>â¹ ë…¹ìŒ ì¢…ë£Œ</button>
          </div>
          <div class="recordings" id="recordings-panel" hidden>
            <h3>ë‚´ ë…¹ìŒ ëª¨ìŒ</h3>
            <div class="recordings-list" id="recordings-list"></div>
          </div>
        </div>

      </section>

      <footer>Â© 2025 TOEIC Melody Trainer</footer>
    </div>

    <script>
      const melodyText = `June twenty-second.

Ben Werth

Werth Construction Company

555 Alaska Avenue

Chalmers, NB M1B 4N3

Dear Mr. Werth,

Thank you for sending the final payment for your recent order, which consisted of forty cubic feet of lumber delivered on June fifteenth. As you requested, we have enclosed the receipt showing the bill has been paid in full. However, we wish to remind you that you still have one remaining outstanding bill for flooring.

As for delivery of the flooring, we have checked with the warehouse and they said the materials can be sent to you by July fifth. If that day is acceptable to you, we will go ahead and process it. Please bear in mind that we will need confirmation from you by June twenty-ninth in order to make the July fifth date. Otherwise, we cannot guarantee the July fifth delivery date. We hope to hear from you soon.

Sincerely,
John May.`;

      // ë¬¸ì¥ë³„ í•œêµ­ì–´ í•´ì„
      const translations = {
        'June twenty-second.': '6ì›” 22ì¼',
        'Ben Werth': 'Ben Werth',
        'Werth Construction Company': 'Werth ê±´ì„¤ íšŒì‚¬',
        '555 Alaska Avenue': 'ì•Œë˜ìŠ¤ì¹´ ê±°ë¦¬ 555ë²ˆì§€',
        'Chalmers, NB M1B 4N3': 'Chalmers, NB M1B 4N3',
        'Dear Mr. Werth,': 'Werthë‹˜ê»˜,',
        'Thank you for sending the final payment for your recent order, which consisted of forty cubic feet of lumber delivered on June fifteenth.': 'ìµœê·¼ ì£¼ë¬¸í•˜ì‹  40ì…ë°©í”¼íŠ¸ì˜ ëª©ì¬(6ì›” 15ì¼ ë°°ì†¡)ì— ëŒ€í•œ ìµœì¢… ê²°ì œë¥¼ ë³´ë‚´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.',
        'As you requested, we have enclosed the receipt showing the bill has been paid in full.': 'ìš”ì²­í•˜ì‹  ëŒ€ë¡œ, ì²­êµ¬ì„œê°€ ì „ì•¡ ê²°ì œë˜ì—ˆìŒì„ ë³´ì—¬ì£¼ëŠ” ì˜ìˆ˜ì¦ì„ ë™ë´‰í–ˆìŠµë‹ˆë‹¤.',
        'However, we wish to remind you that you still have one remaining outstanding bill for flooring.': 'ê·¸ëŸ¬ë‚˜ ì•„ì§ ë°”ë‹¥ì¬ì— ëŒ€í•œ ë¯¸ê²°ì œ ì²­êµ¬ì„œê°€ í•˜ë‚˜ ë‚¨ì•„ìˆìŒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.',
        'As for delivery of the flooring, we have checked with the warehouse and they said the materials can be sent to you by July fifth.': 'ë°”ë‹¥ì¬ ë°°ì†¡ì— ê´€í•´ì„œëŠ”, ì°½ê³ ì— í™•ì¸í•œ ê²°ê³¼ 7ì›” 5ì¼ê¹Œì§€ ìì¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.',
        'If that day is acceptable to you, we will go ahead and process it.': 'ê·¸ ë‚ ì§œê°€ ê´œì°®ìœ¼ì‹œë‹¤ë©´, ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.',
        'Please bear in mind that we will need confirmation from you by June twenty-ninth in order to make the July fifth date.': '7ì›” 5ì¼ ë‚ ì§œë¥¼ ë§ì¶”ê¸° ìœ„í•´ì„œëŠ” 6ì›” 29ì¼ê¹Œì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
        'Otherwise, we cannot guarantee the July fifth delivery date.': 'ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ 7ì›” 5ì¼ ë°°ì†¡ ë‚ ì§œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        'We hope to hear from you soon.': 'ê³§ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.',
        'Sincerely,': 'ì§„ì‹¬ì„ ë‹´ì•„,',
        'John May.': 'John May.'
      };


      const melodyContainer = document.getElementById('melody-text');
      const melodyToggle = document.getElementById('melody-toggle');
      const melodyStop = document.getElementById('melody-stop');
      const melodyStatus = document.getElementById('melody-status');
      const toggleTranslation = document.getElementById('toggle-translation');

      const speechToggle = document.getElementById('speech-toggle');
      const speechStop = document.getElementById('speech-stop');
      const speechStatus = document.getElementById('speech-status');

      const recordToggle = document.getElementById('record-toggle');
      const recordStop = document.getElementById('record-stop');
      const recordStatus = document.getElementById('record-status');
      const recordingsPanel = document.getElementById('recordings-panel');
      const recordingsList = document.getElementById('recordings-list');


      const speedSlider = document.getElementById('speed-range');
      const speedValue = document.getElementById('speed-value');

      let wordSpans = [];
      let noteSchedule = [];
      let highlightTimeouts = [];
      let audioCtx = null;
      let isMelodyPlaying = false;

      let playbackSpeed = 1.0;

      const STRESS_PITCH_OFFSETS = {
        primary: 7,
        secondary: 4,
        weak: 0,
      };

      const MELODIC_MOTIF = [0, 2, 4, 5, 7, 9, 12, 9, 7, 5];
      const RHYTHM_PATTERN = [0.55, 0.4, 0.7, 0.5, 0.65, 0.45];

      let activeNodes = [];
      let masterGain = null;
      let ambienceDelay = null;
      let ambienceFeedback = null;
      let ambienceTone = null;
      let accompanimentGain = null;

      let speechUtterance = null;
      let isSpeechPlaying = false;
      let wasSpeechPaused = false;

      let mediaRecorder = null;
      let recordedChunks = [];
      let recordingCount = 0;

      // MP3 ì˜¤ë””ì˜¤ ìš”ì†Œ ì¶”ê°€
      // ì—¬ëŸ¬ ê²½ë¡œë¥¼ ì‹œë„ (ê°œë°œ ì„œë²„ìš© ì ˆëŒ€ ê²½ë¡œ, ì§ì ‘ ì—´ê¸°ìš© ìƒëŒ€ ê²½ë¡œ)
      const mp3Audio = new Audio();
      let isMp3Playing = false;
      let highlightIntervalId = null;
      let progressUpdateInterval = null;
      
      // ì¬ìƒë°” ìš”ì†Œ
      const melodyProgressContainer = document.getElementById('melody-progress-container');
      const melodyProgressBar = document.getElementById('melody-progress-bar');
      const melodyProgressFill = document.getElementById('melody-progress-fill');
      const melodyProgressHandle = document.getElementById('melody-progress-handle');
      const melodyCurrentTime = document.getElementById('melody-current-time');
      const melodyDuration = document.getElementById('melody-duration');
      
      // MP3 íŒŒì¼ ê²½ë¡œ ì‹œë„ (ìš°ì„ ìˆœìœ„ ìˆœ)
      const audioPaths = [
        '/toeic-melody-learning.mp3',  // Vite ê°œë°œ ì„œë²„ìš©
        './public/toeic-melody-learning.mp3',  // ìƒëŒ€ ê²½ë¡œ
        './toeic-melody-learning.mp3',  // ê°™ì€ í´ë”
        'toeic-melody-learning.mp3'  // í˜„ì¬ ë””ë ‰í† ë¦¬
      ];
      
      let currentPathIndex = 0;
      
      const tryLoadAudio = () => {
        if (currentPathIndex >= audioPaths.length) {
          console.error('ëª¨ë“  ê²½ë¡œì—ì„œ MP3 íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          updateMelodyStatus('ë©œë¡œë””: íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          alert('MP3 íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\níŒŒì¼ ìœ„ì¹˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”:\n- public/toeic-melody-learning.mp3\në˜ëŠ”\n- HTML íŒŒì¼ê³¼ ê°™ì€ í´ë”');
          return;
        }
        
        mp3Audio.src = audioPaths[currentPathIndex];
        console.log(`MP3 íŒŒì¼ ë¡œë“œ ì‹œë„: ${audioPaths[currentPathIndex]}`);
      };
      
      // MP3 íŒŒì¼ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬
      mp3Audio.addEventListener('error', (e) => {
        console.error(`MP3 íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜ (${audioPaths[currentPathIndex]}):`, e);
        currentPathIndex++;
        tryLoadAudio();
      });
      
      mp3Audio.addEventListener('loadeddata', () => {
        console.log(`MP3 íŒŒì¼ ë¡œë“œ ì„±ê³µ: ${audioPaths[currentPathIndex]}`);
        updateMelodyStatus('ë©œë¡œë””: ì¤€ë¹„ ì™„ë£Œ');
      });
      
      // ì´ˆê¸° ë¡œë“œ ì‹œë„
      tryLoadAudio();

      // ì¤‘ìš”í•œ ë‹¨ì–´ ëª©ë¡
      const importantWords = new Set([
        'payment', 'remaining', 'outstanding', 'delivery', 'warehouse',
        'materials', 'acceptable', 'confirmation', 'guarantee', 'enclosed',
        'receipt', 'consisted', 'cubic', 'lumber', 'promptly'
      ]);

      const createWordSpan = (word, index, pitch = null, isImportant = false) => {
        const span = document.createElement('span');
        span.textContent = word;
        span.dataset.index = index;
        span.className = 'word-token';
        
        // ì¤‘ìš”í•œ ë‹¨ì–´ì¸ì§€ í™•ì¸
        const clean = word.replace(/[^A-Za-z']/g, '').toLowerCase();
        const isImportantWord = isImportant || importantWords.has(clean);
        
        // ì¤‘ìš”í•œ ë‹¨ì–´ì—ë§Œ Pitch visualization ì¶”ê°€
        if (isImportantWord && pitch !== null) {
          span.dataset.pitch = pitch;
          
          // ì¤‘ìš”í•œ ë‹¨ì–´ í‘œì‹œ
          if (isImportantWord) {
            span.setAttribute('data-stress', 'primary');
          }
          
          // Pitch ë§‰ëŒ€ ì»¨í…Œì´ë„ˆ
          const pitchBarContainer = document.createElement('div');
          pitchBarContainer.className = 'pitch-bar-container';
          
          // 3ê°œì˜ ë§‰ëŒ€ë¡œ ìŒê³  í‘œí˜„ (ë‚®ìŒ, ì¤‘ê°„, ë†’ìŒ)
          const pitchLevels = [
            Math.max(0, pitch - 0.2), // ë‚®ì€ ìŒ
            pitch, // ì¤‘ê°„ ìŒ
            Math.min(1, pitch + 0.2) // ë†’ì€ ìŒ
          ];
          
          pitchLevels.forEach((level) => {
            const bar = document.createElement('div');
            bar.className = 'pitch-bar';
            // ìµœì†Œ ë†’ì´ 3px, ìµœëŒ€ ë†’ì´ 14px (ë” ì‘ê²Œ)
            const barHeight = 3 + (level * 11);
            bar.style.height = `${barHeight}px`;
            pitchBarContainer.appendChild(bar);
          });
          
          span.appendChild(pitchBarContainer);
          
          // Pitch ì  (ìƒë‹¨) - pitchê°€ ë†’ì„ìˆ˜ë¡ ë” ìœ„ì—
          const pitchDot = document.createElement('div');
          pitchDot.className = 'pitch-dot';
          // pitch 0ì¼ ë•Œ -20px, pitch 1ì¼ ë•Œ -30px (ë²”ìœ„ ì¶•ì†Œ)
          const dotTop = -20 - (pitch * 10);
          pitchDot.style.top = `${dotTop}px`;
          span.appendChild(pitchDot);
        }
        
        return span;
      };

      // ë‹¨ì–´ë³„ pitch ë°ì´í„° ìƒì„± (ì¤‘ìš”í•œ ë‹¨ì–´ë§Œ)
      const generatePitchData = () => {
        const pitchMap = new Map();
        const words = melodyText.trim().split(/\s+/).filter(w => w);
        
        words.forEach((word, idx) => {
          const clean = word.replace(/[^A-Za-z']/g, '').toLowerCase();
          if (!clean) return;
          
          const isImportant = importantWords.has(clean);
          
          // ì¤‘ìš”í•œ ë‹¨ì–´ë§Œ pitch ë°ì´í„° ìƒì„±
          if (isImportant) {
            // Pitch ê³„ì‚°: ì¤‘ìš”í•œ ë‹¨ì–´ëŠ” ë†’ê²Œ
            // MIDI noteë¥¼ 0-1 ë²”ìœ„ë¡œ ì •ê·œí™” (C4=60 ~ C6=84 -> 0.0 ~ 1.0)
            const baseMidi = 64; // E4
            const motifStep = MELODIC_MOTIF[idx % MELODIC_MOTIF.length];
            const stressOffset = STRESS_PITCH_OFFSETS.primary;
            const midi = baseMidi + motifStep + stressOffset;
            
            // MIDI 60-84 ë²”ìœ„ë¥¼ 0-1ë¡œ ì •ê·œí™”
            const normalizedPitch = Math.max(0, Math.min(1, (midi - 60) / 24));
            pitchMap.set(idx, normalizedPitch);
          }
        });
        
        return pitchMap;
      };

      const renderMelodyText = () => {
        const pitchMap = generatePitchData();
        const paragraphs = melodyText.trim().split(/\n\s*\n/);
        let wordIndex = 0;
        paragraphs.forEach((paragraph) => {
          const paragraphWrapper = document.createElement('div');
          paragraphWrapper.style.marginBottom = '20px';
          
          // ì˜ì–´ ë¬¸ì¥ ë Œë”ë§
          const paragraphEl = document.createElement('p');
          paragraphEl.style.margin = '0 0 6px 0';
          paragraphEl.style.lineHeight = '2.2';
          const words = paragraph.split(/\s+/);
          words.forEach((word) => {
            if (!word) return;
            const clean = word.replace(/[^A-Za-z']/g, '').toLowerCase();
            const isImportant = importantWords.has(clean);
            // ì¤‘ìš”í•œ ë‹¨ì–´ë§Œ pitch ì „ë‹¬
            const pitch = isImportant ? pitchMap.get(wordIndex) : null;
            const span = createWordSpan(word, wordIndex, pitch, isImportant);
            wordSpans.push(span);
            paragraphEl.appendChild(span);
            paragraphEl.appendChild(document.createTextNode(' '));
            wordIndex += 1;
          });
          paragraphWrapper.appendChild(paragraphEl);
          
          // ë¬¸ì¥ë³„ í•´ì„ ì¶”ê°€
          const sentences = paragraph.split(/([.!?]\s+)/);
          let currentSentence = '';
          sentences.forEach((part) => {
            currentSentence += part;
            if (/[.!?]/.test(part)) {
              const cleanSentence = currentSentence.trim();
              const translationText = translations[cleanSentence] || '';
              if (translationText) {
                const translationEl = document.createElement('p');
                translationEl.className = 'translation-text';
                translationEl.textContent = translationText;
                paragraphWrapper.appendChild(translationEl);
              }
              currentSentence = '';
            }
          });
          
          // ë§ˆì§€ë§‰ ë¬¸ì¥ ì²˜ë¦¬ (ë§ˆì¹¨í‘œ ì—†ì´ ëë‚˜ëŠ” ê²½ìš°)
          if (currentSentence.trim()) {
            const translationText = translations[currentSentence.trim()] || '';
            if (translationText) {
              const translationEl = document.createElement('p');
              translationEl.className = 'translation-text';
              translationEl.textContent = translationText;
              paragraphWrapper.appendChild(translationEl);
            }
          }
          
          melodyContainer.appendChild(paragraphWrapper);
        });
      };

      const midiToFrequency = (midi) => 440 * Math.pow(2, (midi - 69) / 12);

      const buildNoteSchedule = () => {
        noteSchedule = [];
        let currentTime = 0;
        let motifIndex = 0;
        const baseMidi = 64; // E4
        
        // ë…¸ë€ìƒ‰ í˜•ê´‘íœìœ¼ë¡œ í‘œì‹œí•  ì¤‘ìš”í•œ ë‹¨ì–´ë“¤ (ì†Œë¬¸ìë¡œ ë¹„êµ)
        const importantWords = new Set([
          'payment', 'remaining', 'outstanding', 'delivery', 'warehouse',
          'materials', 'acceptable', 'confirmation', 'guarantee', 'enclosed',
          'receipt', 'consisted', 'cubic', 'lumber', 'promptly'
        ]);
        
        wordSpans.forEach((span, idx) => {
          const raw = span.textContent || '';
          const clean = raw.replace(/[^A-Za-z']/g, '').toLowerCase();
          if (!clean) return;

          // ì¤‘ìš”í•œ ë‹¨ì–´ì¸ì§€ í™•ì¸
          const isImportant = importantWords.has(clean);
          const stressLabel = isImportant ? 'primary' : 'weak';
          const stressOffset = STRESS_PITCH_OFFSETS[stressLabel];

          // ì¤‘ìš”í•œ ë‹¨ì–´ë§Œ ë…¸ë€ìƒ‰ í˜•ê´‘íœ í‘œì‹œ
          if (isImportant) {
            span.setAttribute('data-stress', 'primary');
          }

          const motifStep = MELODIC_MOTIF[motifIndex % MELODIC_MOTIF.length];
          const midi = baseMidi + motifStep + stressOffset;

          const rhythmBase = RHYTHM_PATTERN[motifIndex % RHYTHM_PATTERN.length];
          const lengthBonus = clean.length > 7 ? 0.25 : clean.length > 4 ? 0.1 : 0;
          const cadenceBonus = /[.,!?]$/.test(raw) ? 0.35 : 0;
          const duration = Math.max(0.32, rhythmBase + lengthBonus + cadenceBonus);
          const rest = /[.!?]$/.test(raw) ? 0.28 : 0.12;

          noteSchedule.push({
            start: currentTime,
            end: currentTime + duration,
            duration,
            midi,
            span,
            stress: stressLabel,
          });

          currentTime += duration + rest;
          motifIndex += 1;
        });
      };

      const resetHighlights = () => {
        wordSpans.forEach((span) => {
          span.classList.remove('active');
          // Pitch visualization ì´ˆê¸°í™”
          const pitchBars = span.querySelectorAll('.pitch-bar');
          const pitchDot = span.querySelector('.pitch-dot');
          
          if (pitchBars.length > 0) {
            pitchBars.forEach((bar) => {
              bar.style.transform = 'scaleY(1)';
            });
          }
          
          if (pitchDot) {
            pitchDot.style.transform = 'translateX(-50%) scale(1)';
          }
        });
      };

      const clearHighlightTimeouts = () => {
        highlightTimeouts.forEach((timeout) => clearTimeout(timeout));
        highlightTimeouts = [];
      };

      const updateMelodyStatus = (text) => {
        melodyStatus.textContent = `ğŸ¼ ${text}`;
      };

      const getGainForStress = (stress) => {
        if (stress === 'primary') return 0.32;
        if (stress === 'secondary') return 0.25;
        return 0.18;
      };

      const startMelody = () => {
        if (!noteSchedule.length) {
          buildNoteSchedule();
        }
        if (!noteSchedule.length || isMelodyPlaying) return;

        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.resume().catch(() => {});
        resetHighlights();
        clearHighlightTimeouts();
        activeNodes = [];

        const speed = playbackSpeed;
        const startTime = audioCtx.currentTime + 0.12;
        isMelodyPlaying = true;
        melodyToggle.textContent = 'â¹ ë©œë¡œë”” ì •ì§€';
        melodyStop.disabled = false;
        updateMelodyStatus(`ë©œë¡œë”” ì¬ìƒ ì¤‘ Â· ${speed.toFixed(1)}x`);

        masterGain = audioCtx.createGain();
        masterGain.gain.setValueAtTime(0.55, startTime);

        accompanimentGain = audioCtx.createGain();
        accompanimentGain.gain.setValueAtTime(0.25, startTime);

        const chordProgression = ['Cmaj7', 'Am7', 'Dm7', 'G7'];
        const chordVoicings = {
          Cmaj7: [60, 64, 67, 71],
          Am7: [57, 60, 64, 67],
          Dm7: [62, 65, 69, 72],
          G7: [55, 59, 62, 65],
        };

        const arpeggiateChord = (startBeat, chordName, lengthBeats) => {
          const notes = chordVoicings[chordName];
          const beatDuration = 0.6 / speed;
          notes.forEach((note, index) => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const start = startTime + (startBeat + index * 0.4) * beatDuration;
            const noteDuration = lengthBeats * beatDuration * 0.8;

            osc.type = 'sine';
            osc.frequency.setValueAtTime(midiToFrequency(note), start);

            gain.gain.setValueAtTime(0.0001, start);
            gain.gain.linearRampToValueAtTime(0.18, start + 0.08);
            gain.gain.exponentialRampToValueAtTime(0.0001, start + noteDuration);

            osc.connect(gain).connect(accompanimentGain);
            osc.start(start);
            osc.stop(start + noteDuration + 0.1);

            activeNodes.push({ oscillator: osc });
          });
        };

        chordProgression.forEach((chord, idx) => {
          arpeggiateChord(idx * 4, chord, 4);
        });

        ambienceDelay = audioCtx.createDelay();
        ambienceDelay.delayTime.setValueAtTime(0.24, startTime);
        ambienceFeedback = audioCtx.createGain();
        ambienceFeedback.gain.setValueAtTime(0.22, startTime);
        ambienceDelay.connect(ambienceFeedback).connect(ambienceDelay);

        ambienceTone = audioCtx.createGain();
        ambienceTone.gain.setValueAtTime(0.35, startTime);

        masterGain.connect(audioCtx.destination);
        masterGain.connect(ambienceDelay);
        ambienceDelay.connect(ambienceTone).connect(audioCtx.destination);
        accompanimentGain.connect(audioCtx.destination);
        accompanimentGain.connect(ambienceDelay);

        noteSchedule.forEach((note) => {
          const oscillator = audioCtx.createOscillator();
          const gainNode = audioCtx.createGain();
          const filter = audioCtx.createBiquadFilter();
          filter.type = 'lowpass';
          filter.frequency.setValueAtTime(2400, startTime + note.start / speed);
          filter.Q.setValueAtTime(0.8, startTime + note.start / speed);

          const vibrato = audioCtx.createOscillator();
          const vibratoGain = audioCtx.createGain();

          const frequency = midiToFrequency(note.midi);
          const scaledStart = startTime + note.start / speed;
          const scaledDuration = note.duration / speed;
          const noteEnd = scaledStart + scaledDuration;

          oscillator.type = 'triangle';
          oscillator.frequency.setValueAtTime(frequency, scaledStart);

          vibrato.frequency.setValueAtTime(5.2, scaledStart);
          const vibratoDepth =
            note.stress === 'primary' ? 7 : note.stress === 'secondary' ? 5 : 3;
          vibratoGain.gain.setValueAtTime(vibratoDepth, scaledStart);
          vibrato.connect(vibratoGain).connect(oscillator.frequency);

          const baseGain = getGainForStress(note.stress);
          const attack = Math.min(0.08, scaledDuration * 0.3);
          const decay = Math.min(0.12, scaledDuration * 0.25);
          const sustain = baseGain * 0.7;
          const release = Math.max(0.1, scaledDuration * 0.35);

          gainNode.gain.setValueAtTime(0.0001, scaledStart);
          gainNode.gain.linearRampToValueAtTime(baseGain, scaledStart + attack);
          gainNode.gain.linearRampToValueAtTime(sustain, scaledStart + attack + decay);
          gainNode.gain.setValueAtTime(
            sustain,
            Math.max(scaledStart + attack + decay, noteEnd - release)
          );
          gainNode.gain.linearRampToValueAtTime(0.0001, noteEnd);

          const shimmer = audioCtx.createOscillator();
          shimmer.type = 'sine';
          shimmer.frequency.setValueAtTime(frequency * 2, scaledStart);
          const shimmerGain = audioCtx.createGain();
          shimmerGain.gain.setValueAtTime(baseGain * 0.25, scaledStart);

          oscillator.connect(filter);
          shimmer.connect(shimmerGain).connect(filter);
          filter.connect(gainNode).connect(masterGain);

          oscillator.start(scaledStart);
          oscillator.stop(noteEnd + 0.05);
          vibrato.start(scaledStart);
          vibrato.stop(noteEnd + 0.05);
          shimmer.start(scaledStart);
          shimmer.stop(noteEnd + 0.05);

          activeNodes.push({ oscillator, vibrato, shimmer });

          const highlightDelay = Math.max(0, (scaledStart - audioCtx.currentTime) * 1000);
          const highlightTimeout = setTimeout(() => {
            resetHighlights();
            note.span.classList.add('active');
          }, highlightDelay);
          highlightTimeouts.push(highlightTimeout);
        });

        const totalDuration = noteSchedule.length
          ? noteSchedule[noteSchedule.length - 1].start +
            noteSchedule[noteSchedule.length - 1].duration
          : 0;
        const finishDelay = Math.max(
          0,
          (startTime + totalDuration / speed - audioCtx.currentTime + 0.1) * 1000
        );
        highlightTimeouts.push(
          setTimeout(() => {
            stopMelody();
          }, finishDelay)
        );
      };

      const stopMelody = () => {
        if (audioCtx) {
          const now = audioCtx.currentTime;
          activeNodes.forEach((node) => {
            const { oscillator, vibrato, shimmer } = node;
            try {
              oscillator.stop(now + 0.01);
            } catch (e) {}
            try {
              if (vibrato) vibrato.stop(now + 0.01);
            } catch (e) {}
            try {
              if (shimmer) shimmer.stop(now + 0.01);
            } catch (e) {}
          });
          activeNodes = [];
          if (masterGain) {
            masterGain.disconnect();
            masterGain = null;
          }
          if (accompanimentGain) {
            accompanimentGain.disconnect();
            accompanimentGain = null;
          }
          if (ambienceDelay) {
            ambienceDelay.disconnect();
            ambienceDelay = null;
          }
          if (ambienceFeedback) {
            ambienceFeedback.disconnect();
            ambienceFeedback = null;
          }
          if (ambienceTone) {
            ambienceTone.disconnect();
            ambienceTone = null;
          }
          audioCtx.close().catch(() => {});
          audioCtx = null;
        }
        isMelodyPlaying = false;
        melodyToggle.textContent = 'ğŸµ ë©œë¡œë”” ì¬ìƒ';
        melodyStop.disabled = true;
        updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        resetHighlights();
        clearHighlightTimeouts();
      };

      // ì‹œê°„ í¬ë§· í•¨ìˆ˜
      const formatTime = (seconds) => {
        if (!isFinite(seconds) || isNaN(seconds)) return '0:00';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      // ì¬ìƒë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      const updateProgressBar = (current, duration) => {
        if (!duration || duration === 0) return;
        const percentage = (current / duration) * 100;
        melodyProgressFill.style.width = `${percentage}%`;
        melodyProgressHandle.style.left = `${percentage}%`;
        melodyCurrentTime.textContent = formatTime(current);
      };

      // ì¬ìƒë°” ì—…ë°ì´íŠ¸ ì‹œì‘
      const startProgressUpdate = () => {
        stopProgressUpdate(); // ê¸°ì¡´ ì¸í„°ë²Œ ì œê±°
        progressUpdateInterval = setInterval(() => {
          if (isMp3Playing && mp3Audio.duration) {
            updateProgressBar(mp3Audio.currentTime, mp3Audio.duration);
          }
        }, 100); // 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸
      };


      // ì¬ìƒë°” ì—…ë°ì´íŠ¸ ì¤‘ì§€
      const stopProgressUpdate = () => {
        if (progressUpdateInterval) {
          clearInterval(progressUpdateInterval);
          progressUpdateInterval = null;
        }
      };

      // ì¬ìƒë°” í´ë¦­ìœ¼ë¡œ ìœ„ì¹˜ ì´ë™
      melodyProgressBar.addEventListener('click', (e) => {
        if (!mp3Audio.duration) return;
        const rect = melodyProgressBar.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const percentage = clickX / rect.width;
        const newTime = percentage * mp3Audio.duration;
        mp3Audio.currentTime = Math.max(0, Math.min(newTime, mp3Audio.duration));
        updateProgressBar(mp3Audio.currentTime, mp3Audio.duration);
      });

      melodyToggle.addEventListener('click', async () => {
        // MP3 íŒŒì¼ ì¬ìƒ/ì¼ì‹œì •ì§€ (ë©œë¡œë”” ì¬ìƒ ë²„íŠ¼)
        if (isMp3Playing) {
          // ì¼ì‹œì •ì§€
          mp3Audio.pause();
          isMp3Playing = false;
          stopProgressUpdate();
          melodyToggle.textContent = 'ğŸµ ë©œë¡œë”” ì¬ìƒ';
          melodyStop.disabled = true;
          updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        } else {
          // ê¸°ì¡´ Web Audio ë©œë¡œë”” ì •ì§€
          if (isMelodyPlaying) {
            stopMelody();
          }
          
          // noteScheduleì´ ì—†ìœ¼ë©´ ë¨¼ì € ë¹Œë“œ
          if (!noteSchedule.length) {
            buildNoteSchedule();
          }
          
          // MP3 ì¬ìƒ
          try {
            console.log('MP3 íŒŒì¼ ì¬ìƒ ì‹œì‘: /toeic-melody-learning.mp3');
            mp3Audio.currentTime = 0;
            mp3Audio.playbackRate = playbackSpeed;
            
            // MP3 íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            const waitForDuration = () => {
              return new Promise((resolve) => {
                if (mp3Audio.duration && mp3Audio.duration > 0) {
                  resolve(mp3Audio.duration);
                } else {
                  const onLoadedMetadata = () => {
                    mp3Audio.removeEventListener('loadedmetadata', onLoadedMetadata);
                    resolve(mp3Audio.duration || 0);
                  };
                  mp3Audio.addEventListener('loadedmetadata', onLoadedMetadata);
                  // íƒ€ì„ì•„ì›ƒ ì„¤ì • (5ì´ˆ)
                  setTimeout(() => {
                    mp3Audio.removeEventListener('loadedmetadata', onLoadedMetadata);
                    resolve(mp3Audio.duration || 0);
                  }, 5000);
                }
              });
            };
            
            const mp3Duration = await waitForDuration();
            await mp3Audio.play();
            
            console.log('MP3 ì¬ìƒ ì„±ê³µ, ê¸¸ì´:', mp3Duration);
            isMp3Playing = true;
            melodyToggle.textContent = 'â¸ ë©œë¡œë”” ì¼ì‹œì •ì§€';
            melodyStop.disabled = false;
            updateMelodyStatus(`ë©œë¡œë”” ì¬ìƒ ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
            
            // ì¬ìƒë°” í‘œì‹œ ë° ì´ˆê¸°í™”
            if (melodyProgressContainer) {
              melodyProgressContainer.style.display = 'flex';
              if (melodyDuration) {
                melodyDuration.textContent = formatTime(mp3Duration);
              }
            }
            
            // ì¬ìƒë°” ì—…ë°ì´íŠ¸ ì‹œì‘
            startProgressUpdate();
            
            mp3Audio.onended = () => {
              console.log('MP3 ì¬ìƒ ì™„ë£Œ');
              isMp3Playing = false;
              melodyToggle.textContent = 'ğŸµ ë©œë¡œë”” ì¬ìƒ';
              melodyStop.disabled = true;
              updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
              stopProgressUpdate();
              // ì¬ìƒë°”ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ
              if (mp3Audio.duration) {
                updateProgressBar(0, mp3Audio.duration);
              }
            };
          } catch (error) {
            console.error('MP3 ì¬ìƒ ì˜¤ë¥˜:', error);
            updateMelodyStatus('ë©œë¡œë””: ì¬ìƒ ì˜¤ë¥˜ - íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            alert('MP3 íŒŒì¼ ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message + '\n\níŒŒì¼ ê²½ë¡œ: /toeic-melody-learning.mp3\níŒŒì¼ì´ public í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
          }
        }
      });

      melodyStop.addEventListener('click', () => {
        if (isMp3Playing) {
          mp3Audio.pause();
          mp3Audio.currentTime = 0;
          isMp3Playing = false;
          stopProgressUpdate();
          if (mp3Audio.duration) {
            updateProgressBar(0, mp3Audio.duration);
          }
          melodyToggle.textContent = 'ğŸµ ë©œë¡œë”” ì¬ìƒ';
          melodyStop.disabled = true;
          updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        } else {
          stopMelody();
        }
      });

      const updateSpeechStatus = (text) => {
        speechStatus.textContent = `ğŸ—£ï¸ ${text}`;
      };

      const resetSpeech = () => {
        isSpeechPlaying = false;
        wasSpeechPaused = false;
        speechToggle.textContent = 'â–¶ ìŒì„± ì¬ìƒ';
        speechStop.disabled = true;
        speechToggle.disabled = false;
        updateSpeechStatus(`ìŒì„±: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
      };

      const speakNarration = ({ onComplete, suppressControls = false } = {}) => {
        if (!('speechSynthesis' in window)) {
          alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìŒì„± í•©ì„±ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return null;
        }
        const utterance = new SpeechSynthesisUtterance(melodyText);
        utterance.lang = 'en-US';
        const rate = Math.min(2.0, Math.max(0.5, 0.92 * playbackSpeed));
        const pitch = Math.max(0.8, Math.min(1.6, 1.1 + (playbackSpeed - 1) * 0.12));
        utterance.rate = rate;
        utterance.pitch = pitch;
        utterance.onend = () => {
          resetSpeech();
          if (typeof onComplete === 'function') {
            onComplete();
          }
        };
        utterance.onerror = utterance.onend;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
        speechUtterance = utterance;
        isSpeechPlaying = true;
        wasSpeechPaused = false;
        if (suppressControls) {
          speechToggle.disabled = true;
          speechStop.disabled = true;
          speechToggle.textContent = 'â¸ ìŒì„± ì¼ì‹œì •ì§€';
        } else {
          speechToggle.disabled = false;
          speechStop.disabled = false;
          speechToggle.textContent = 'â¸ ìŒì„± ì¼ì‹œì •ì§€';
        }
        updateSpeechStatus(`ìŒì„±: ì¬ìƒ ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        return utterance;
      };

      const startSpeech = () => {
        speakNarration();
      };

      speechToggle.addEventListener('click', () => {
        if (!isSpeechPlaying && !wasSpeechPaused) {
          startSpeech();
          return;
        }
        if (isSpeechPlaying && !wasSpeechPaused) {
          window.speechSynthesis.pause();
          isSpeechPlaying = false;
          wasSpeechPaused = true;
          speechToggle.textContent = 'â–¶ ìŒì„± ë‹¤ì‹œ ì¬ìƒ';
          updateSpeechStatus(`ìŒì„±: ì¼ì‹œì •ì§€ Â· ${playbackSpeed.toFixed(1)}x`);
        } else if (!isSpeechPlaying && wasSpeechPaused) {
          window.speechSynthesis.resume();
          isSpeechPlaying = true;
          wasSpeechPaused = false;
          speechToggle.textContent = 'â¸ ìŒì„± ì¼ì‹œì •ì§€';
          updateSpeechStatus(`ìŒì„±: ì¬ìƒ ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        }
      });

      speechStop.addEventListener('click', () => {
        window.speechSynthesis.cancel();
        resetSpeech();
      });

      window.addEventListener('beforeunload', () => {
        window.speechSynthesis.cancel();
      });

      const updateRecordStatus = (text) => {
        recordStatus.textContent = `ğŸ¤ ${text}`;
      };

      const startRecording = async () => {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë…¹ìŒì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          recordedChunks = [];

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: 'audio/webm' });
            const url = URL.createObjectURL(blob);
            recordingCount += 1;
            const audioWrapper = document.createElement('div');
            const label = document.createElement('strong');
            label.textContent = `ë…¹ìŒ ${recordingCount}`;
            audioWrapper.appendChild(label);
            const audio = document.createElement('audio');
            audio.controls = true;
            audio.src = url;
            audioWrapper.appendChild(audio);
            const download = document.createElement('a');
            download.href = url;
            download.textContent = 'ë‹¤ìš´ë¡œë“œ';
            download.download = `toeic-melody-recording-${recordingCount}.webm`;
            download.style.marginLeft = '12px';
            audioWrapper.appendChild(download);
            recordingsList.appendChild(audioWrapper);
            recordingsPanel.hidden = false;
            stream.getTracks().forEach((track) => track.stop());
            recordToggle.disabled = false;
            updateRecordStatus('ë…¹ìŒ: ì™„ë£Œ');
          };

          mediaRecorder.start();
          recordToggle.disabled = true;
          recordStop.disabled = false;
          updateRecordStatus('ë…¹ìŒ ì¤‘...');
        } catch (error) {
          console.error('ë…¹ìŒ ì˜¤ë¥˜:', error);
          alert('ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
        }
      };

      const stopRecording = () => {
        if (!mediaRecorder || mediaRecorder.state !== 'recording') return;
        mediaRecorder.stop();
        recordStop.disabled = true;
        updateRecordStatus('ë…¹ìŒ ì²˜ë¦¬ ì¤‘...');
      };

      speedSlider.addEventListener('input', (event) => {
        const value = parseFloat(event.target.value);
        playbackSpeed = value;
        speedValue.textContent = `${playbackSpeed.toFixed(1)}x`;

        // MP3 ì¬ìƒ ì†ë„ ì—…ë°ì´íŠ¸
        if (isMp3Playing) {
          mp3Audio.playbackRate = playbackSpeed;
        }

        if (isMelodyPlaying) {
          stopMelody();
        } else {
          updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        }

        if (isSpeechPlaying || wasSpeechPaused) {
          window.speechSynthesis.cancel();
          resetSpeech();
        } else {
          updateSpeechStatus(`ìŒì„±: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
        }
      });

      recordToggle.addEventListener('click', startRecording);
      recordStop.addEventListener('click', stopRecording);

      // í€´ì¦ˆ ê¸°ëŠ¥
      const quizData = {
        '4': { correct: 'payment', options: ['payment', 'paying', 'paid', 'pay'] },
        '5': { correct: 'remaining', options: ['remaining', 'remain', 'remained', 'remains'] },
        '6': { correct: 'If', options: ['If', 'When', 'Because', 'Although'] },
        '7': { correct: 'Otherwise, we cannot guarantee the July 5 delivery date', options: [
          'Otherwise, we cannot guarantee the July 5 delivery date',
          'However, we can guarantee the July 5 delivery date',
          'Therefore, we will guarantee the July 5 delivery date',
          'Moreover, we cannot guarantee the July 5 delivery date'
        ]}
      };

      // ë³´ê¸° ì„ íƒ ê¸°ëŠ¥
      document.querySelectorAll('.quiz-option').forEach((option) => {
        option.addEventListener('click', function() {
          const quizId = this.closest('.answer').dataset.quiz;
          const selectedValue = this.dataset.value;
          const correctAnswer = quizData[quizId].correct;
          
          // ê°™ì€ ë¬¸ì œì˜ ë‹¤ë¥¸ ë³´ê¸°ë“¤ ì„ íƒ í•´ì œ
          const quizOptions = this.closest('.answer').querySelectorAll('.quiz-option');
          quizOptions.forEach(opt => {
            opt.classList.remove('selected', 'correct', 'incorrect');
          });
          
          // ì„ íƒí•œ ë³´ê¸° í‘œì‹œ
          this.classList.add('selected');
          
          // ì •ë‹µì´ ì´ë¯¸ í‘œì‹œëœ ê²½ìš° ì •ë‹µ/ì˜¤ë‹µ í‘œì‹œ
          const answerReveal = document.getElementById(`answer-${quizId}`);
          if (answerReveal && answerReveal.classList.contains('show')) {
            if (selectedValue === correctAnswer) {
              this.classList.add('correct');
            } else {
              this.classList.add('incorrect');
              // ì •ë‹µ ë³´ê¸°ë„ í‘œì‹œ
              quizOptions.forEach(opt => {
                if (opt.dataset.value === correctAnswer) {
                  opt.classList.add('correct');
                }
              });
            }
          }
        });
      });

      // ì •ë‹µ í™•ì¸ ë²„íŠ¼
      document.querySelectorAll('.show-answer-btn').forEach((btn) => {
        btn.addEventListener('click', function() {
          const quizId = this.dataset.quiz;
          const answerReveal = document.getElementById(`answer-${quizId}`);
          const quizOptions = this.closest('.answer').querySelectorAll('.quiz-option');
          const correctAnswer = quizData[quizId].correct;
          
          // ì •ë‹µ í‘œì‹œ
          answerReveal.classList.add('show');
          this.style.display = 'none';
          
          // ì„ íƒí•œ ë³´ê¸°ê°€ ìˆìœ¼ë©´ ì •ë‹µ/ì˜¤ë‹µ í‘œì‹œ
          const selectedOption = this.closest('.answer').querySelector('.quiz-option.selected');
          if (selectedOption) {
            const selectedValue = selectedOption.dataset.value;
            if (selectedValue === correctAnswer) {
              selectedOption.classList.add('correct');
              selectedOption.classList.remove('incorrect');
            } else {
              selectedOption.classList.add('incorrect');
              // ì •ë‹µ ë³´ê¸° í‘œì‹œ
              quizOptions.forEach(opt => {
                if (opt.dataset.value === correctAnswer) {
                  opt.classList.add('correct');
                }
              });
            }
          } else {
            // ì„ íƒí•˜ì§€ ì•Šì•˜ì–´ë„ ì •ë‹µ ë³´ê¸° í‘œì‹œ
            quizOptions.forEach(opt => {
              if (opt.dataset.value === correctAnswer) {
                opt.classList.add('correct');
              }
            });
          }
        });
      });

      // í•´ì„ ë³´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€
      let isTranslationVisible = false;
      toggleTranslation.addEventListener('click', () => {
        isTranslationVisible = !isTranslationVisible;
        const translationElements = document.querySelectorAll('.translation-text');
        translationElements.forEach((el) => {
          if (isTranslationVisible) {
            el.classList.add('show');
          } else {
            el.classList.remove('show');
          }
        });
        toggleTranslation.textContent = isTranslationVisible ? 'ğŸ™ˆ ì›ë¬¸ í•´ì„ ìˆ¨ê¸°ê¸°' : 'ğŸ“– ì›ë¬¸ í•´ì„ ë³´ê¸°';
      });

      // ë‹¨ì–´ í•™ìŠµ ë°ì´í„°
      const vocabularyData = [
        {
          word: 'payment',
          pronunciation: '/ËˆpeÉªmÉ™nt/',
          meaning: 'ê²°ì œ, ì§€ë¶ˆ',
          part: 'n.',
          example: 'Thank you for sending the final payment for your recent order.'
        },
        {
          word: 'remaining',
          pronunciation: '/rÉªËˆmeÉªnÉªÅ‹/',
          meaning: 'ë‚¨ì•„ìˆëŠ”, ì”ì—¬ì˜',
          part: 'adj.',
          example: 'You still have one remaining outstanding bill for flooring.'
        },
        {
          word: 'outstanding',
          pronunciation: '/aÊŠtËˆstÃ¦ndÉªÅ‹/',
          meaning: 'ë¯¸ê²°ì œì˜, ë¯¸í•´ê²°ì˜',
          part: 'adj.',
          example: 'You still have one remaining outstanding bill for flooring.'
        },
        {
          word: 'flooring',
          pronunciation: '/ËˆflÉ”ËrÉªÅ‹/',
          meaning: 'ë°”ë‹¥ì¬',
          part: 'n.',
          example: 'You still have one remaining outstanding bill for flooring.'
        },
        {
          word: 'warehouse',
          pronunciation: '/ËˆwerhaÊŠs/',
          meaning: 'ì°½ê³ ',
          part: 'n.',
          example: 'We have checked with the warehouse and they said the materials can be sent to you.'
        },
        {
          word: 'materials',
          pronunciation: '/mÉ™ËˆtÉªriÉ™lz/',
          meaning: 'ìì¬, ì¬ë£Œ',
          part: 'n.',
          example: 'The materials can be sent to you by July 5.'
        },
        {
          word: 'confirmation',
          pronunciation: '/ËŒkÉ‘ËnfÉ™rËˆmeÉªÊƒÉ™n/',
          meaning: 'í™•ì¸, í™•ì¸ì„œ',
          part: 'n.',
          example: 'We will need confirmation from you by June 29.'
        },
        {
          word: 'guarantee',
          pronunciation: '/ËŒÉ¡Ã¦rÉ™nËˆtiË/',
          meaning: 'ë³´ì¥í•˜ë‹¤, ë³´ì¦í•˜ë‹¤',
          part: 'v.',
          example: 'We cannot guarantee the July 5 delivery date.'
        },
        {
          word: 'delivery',
          pronunciation: '/dÉªËˆlÉªvÉ™ri/',
          meaning: 'ë°°ì†¡, ì „ë‹¬',
          part: 'n.',
          example: 'As for delivery of the flooring, we have checked with the warehouse.'
        },
        {
          word: 'enclosed',
          pronunciation: '/ÉªnËˆkloÊŠzd/',
          meaning: 'ë™ë´‰ëœ',
          part: 'adj.',
          example: 'We have enclosed the receipt showing the bill has been paid in full.'
        },
        {
          word: 'receipt',
          pronunciation: '/rÉªËˆsiËt/',
          meaning: 'ì˜ìˆ˜ì¦',
          part: 'n.',
          example: 'We have enclosed the receipt showing the bill has been paid in full.'
        },
        {
          word: 'lumber',
          pronunciation: '/ËˆlÊŒmbÉ™r/',
          meaning: 'ëª©ì¬',
          part: 'n.',
          example: 'Forty cubic feet of lumber delivered on June 15.'
        },
        {
          word: 'acceptable',
          pronunciation: '/É™kËˆseptÉ™bÉ™l/',
          meaning: 'ìˆ˜ìš© ê°€ëŠ¥í•œ, ê´œì°®ì€',
          part: 'adj.',
          example: 'If that day is acceptable to you, we will go ahead and process it.'
        },
        {
          word: 'process',
          pronunciation: '/ËˆprÉ‘Ëses/',
          meaning: 'ì²˜ë¦¬í•˜ë‹¤, ì§„í–‰í•˜ë‹¤',
          part: 'v.',
          example: 'If that day is acceptable to you, we will go ahead and process it.'
        },
        {
          word: 'otherwise',
          pronunciation: '/ËˆÊŒÃ°É™rwaÉªz/',
          meaning: 'ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ê·¸ ì™¸ì—ëŠ”',
          part: 'adv.',
          example: 'Otherwise, we cannot guarantee the July 5 delivery date.'
        }
      ];

      // ë‹¨ì–´ ì¹´ë“œ ë Œë”ë§
      const renderVocabulary = () => {
        const vocabularyGrid = document.getElementById('vocabulary-grid');
        if (!vocabularyGrid) return;

        vocabularyGrid.innerHTML = '';

        vocabularyData.forEach((vocab) => {
          const card = document.createElement('div');
          card.className = 'vocab-card';
          card.innerHTML = `
            <div class="vocab-word">
              ${vocab.word}
              <span class="vocab-part">${vocab.part}</span>
            </div>
            <div class="vocab-pronunciation">${vocab.pronunciation}</div>
            <div class="vocab-meaning">
              <strong>ëœ»:</strong> ${vocab.meaning}
            </div>
            <div class="vocab-example">
              <strong>ì˜ˆë¬¸:</strong> ${vocab.example}
            </div>
            <div class="vocab-flip-hint">ğŸ‘† í´ë¦­í•˜ì—¬ ëœ» ë³´ê¸°</div>
          `;

          card.addEventListener('click', () => {
            card.classList.toggle('flipped');
          });

          vocabularyGrid.appendChild(card);
        });
      };

      renderMelodyText();
      buildNoteSchedule();
      renderVocabulary();
      updateMelodyStatus(`ë©œë¡œë””: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
      updateSpeechStatus(`ìŒì„±: ëŒ€ê¸° ì¤‘ Â· ${playbackSpeed.toFixed(1)}x`);
    </script>
  </body>
</html>

  </body>
</html>
